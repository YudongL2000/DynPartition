import matplotlib.pyplot as plt
import numpy as np

from dynpartition.get_dir import get_plot_path

gpu_times = [
    [-19.885631561279297, -19.253376007080078, -19.075424194335938,
     -18.391040802001953, -18.929664611816406, -19.00387191772461,
     -19.535200119018555, -20.328447341918945, -18.2476806640625,
     -18.40457534790039, -18.859264373779297, -18.671520233154297,
     -18.382848739624023, -19.744768142700195, -19.42323112487793,
     -18.925567626953125, -18.847936630249023, -18.472000122070312,
     -18.24358367919922, -18.569120407104492, -18.44371223449707,
     -19.667264938354492, -19.113983154296875, -19.077119827270508,
     -18.09231948852539, -18.55232048034668, -18.08777618408203,
     -18.585599899291992, -18.719039916992188, -19.471872329711914,
     -19.798368453979492, -19.15667152404785, -18.418912887573242,
     -18.75382423400879, -18.601152420043945, -19.299808502197266,
     -19.982816696166992, -20.004863739013672, -19.177440643310547,
     -23.360031127929688, -24.186912536621094, -20.273151397705078,
     -22.515552520751953, -19.984928131103516, -19.567007064819336,
     -18.459999084472656, -18.18828773498535, -18.41747283935547,
     -18.550783157348633, -18.876415252685547, -
     19.675039291381836, -20.307968139648438, -18.935199737548828,
     -18.314367294311523, -18.113920211791992, -18.302751541137695,
     -18.843807220458984, -18.884607315063477, -19.25119972229004,
     -19.270015716552734, -18.419584274291992, -18.559423446655273,
     -18.781728744506836, -19.619840621948242, -19.466880798339844,
     -19.326976776123047, -19.713472366333008, -18.990591049194336,
     -18.23539161682129, -18.66547203063965, -18.099775314331055,
     -19.146751403808594, -19.807552337646484, -19.59654426574707,
     -18.278560638427734, -18.60188865661621, -18.2794246673584,
     -19.246143341064453, -19.281055450439453, -20.07811164855957,
     -18.905088424682617, -18.30860710144043, -18.57606315612793,
     -19.09574317932129, -18.788223266601562, -19.25939178466797,
     -19.552448272705078, -19.51590347290039, -18.152544021606445,
     -18.33318328857422, -18.208799362182617, -18.648351669311523,
     -18.358015060424805, -19.925983428955078, -19.322879791259766,
     -19.878047943115234, -19.535072326660156, -21.360448837280273,
     -19.421184539794922, -19.942047119140625],
    [-9.84505558013916, -9.142271995544434, -10.347392082214355,
     -9.438752174377441, -9.390015602111816, -8.938464164733887,
     -9.185279846191406, -10.222463607788086, -9.493439674377441,
     -10.23846435546875, -9.113856315612793, -8.932191848754883,
     -9.0731201171875, -9.484607696533203, -9.233216285705566,
     -9.81811237335205, -10.404288291931152, -9.830431938171387,
     -9.097536087036133, -9.000672340393066, -9.400544166564941,
     -9.58790397644043, -9.089920043945312, -10.346495628356934,
     -10.366975784301758, -9.193471908569336, -10.045248031616211,
     -9.064672470092773, -10.391551971435547, -9.63753604888916,
     -9.08291244506836, -9.162431716918945, -9.141792297363281,
     -9.37558364868164, -9.127936363220215, -10.66163158416748,
     -9.86246395111084, -9.481599807739258, -9.28451156616211,
     -9.18064022064209, -10.296256065368652, -9.396415710449219,
     -10.1310396194458, -9.066495895385742, -9.590944290161133,
     -9.011615753173828, -9.297375679016113, -10.627391815185547,
     -9.691136360168457, -8.501119613647461, -
     8.994815826416016, -9.116543769836426, -9.21731185913086,
     -8.974335670471191, -9.297760009765625, -9.075807571411133,
     -10.843168258666992, -8.8821439743042, -9.069024085998535,
     -9.586624145507812, -9.072832107543945, -9.156607627868652,
     -9.099264144897461, -10.088447570800781, -9.299967765808105,
     -8.470239639282227, -9.027711868286133, -9.090975761413574,
     -9.00915241241455, -9.066495895385742, -9.004351615905762,
     -8.980416297912598, -10.509535789489746, -10.048255920410156,
     -9.029760360717773, -8.941951751708984, -9.210592269897461,
     -8.953503608703613, -8.935423851013184, -9.968159675598145,
     -10.005184173583984, -9.050080299377441, -8.845312118530273,
     -9.03110408782959, -9.347616195678711, -8.90886402130127,
     -9.18342399597168, -9.213600158691406, -10.43660831451416,
     -9.195008277893066, -8.865792274475098, -9.548768043518066,
     -8.996064186096191, -8.765439987182617, -9.191424369812012,
     -10.67852783203125, -9.288064002990723, -9.926719665527344,
     -9.48953628540039, -8.941823959350586],
    [-10.327872276306152, -10.276703834533691, -9.393471717834473,
     -10.789728164672852, -9.854975700378418, -9.359392166137695,
     -9.797632217407227, -9.622719764709473, -10.592255592346191,
     -9.454784393310547, -9.630240440368652, -9.557184219360352,
     -9.48851203918457, -10.95849609375, -9.676799774169922, -9.637887954711914,
     -9.474687576293945, -9.643263816833496, -10.551520347595215,
     -9.896672248840332, -9.876704216003418, -9.654687881469727,
     -9.493375778198242, -10.72111988067627, -9.756704330444336,
     -9.747903823852539, -9.473695755004883, -9.620736122131348,
     -11.124735832214355, -9.52297592163086, -9.863200187683105,
     -9.711392402648926, -9.524959564208984, -10.459136009216309,
     -9.974592208862305, -9.798144340515137, -9.944928169250488,
     -9.511679649353027, -10.58892822265625, -9.407936096191406,
     -9.09603214263916, -9.64793586730957, -9.42080020904541,
     -9.793536186218262, -9.578495979309082, -10.458911895751953,
     -9.465696334838867, -9.756671905517578, -9.43289566040039,
     -9.378656387329102, -
     10.50864028930664, -10.024959564208984, -9.580032348632812,
     -9.408512115478516, -9.689184188842773, -10.308768272399902,
     -9.816831588745117, -8.988160133361816, -9.724991798400879,
     -9.549823760986328, -10.373120307922363, -10.282560348510742,
     -9.761887550354004, -9.627008438110352, -9.763520240783691, -9.9716796875,
     -10.343744277954102, -9.655743598937988, -9.765631675720215,
     -9.499839782714844, -10.79315185546875, -9.920479774475098,
     -9.121824264526367, -9.523200035095215, -9.678848266601562,
     -10.694496154785156, -9.550527572631836, -10.760064125061035,
     -9.885408401489258, -9.493727684020996, -10.17580795288086,
     -9.996031761169434, -9.548704147338867, -9.5731201171875,
     -9.541791915893555, -9.475232124328613, -10.094592094421387,
     -11.01193618774414, -9.473471641540527, -9.867263793945312,
     -9.621439933776855, -9.49779224395752, -10.517855644226074,
     -9.584639549255371, -9.896191596984863, -9.399776458740234,
     -9.51039981842041, -10.529631614685059, -9.805024147033691,
     -9.754624366760254]
]

cpu_times = [
 [-11.968511581420898, -14.162303924560547, -10.403167724609375,
  -10.54422378540039, -10.270976066589355, -10.544032096862793,
  -10.512864112854004, -12.922368049621582, -12.105376243591309,
  -10.88646411895752, -10.287199974060059, -10.572799682617188,
  -11.0164155960083, -10.45139217376709, -11.116703987121582,
  -11.564031600952148, -10.578847885131836, -10.82528018951416,
  -11.683072090148926, -10.562272071838379, -10.654784202575684,
  -11.473152160644531, -11.190879821777344, -14.52239990234375,
  -12.787424087524414, -12.49897575378418, -12.380096435546875,
  -10.93507194519043, -12.053855895996094, -12.505375862121582,
  -14.607263565063477, -18.000320434570312, -16.544767379760742,
  -18.311168670654297, -18.860607147216797, -12.073599815368652,
  -11.139328002929688, -11.121919631958008, -10.73145580291748,
  -11.193183898925781, -11.85696029663086, -11.011520385742188,
  -10.72822380065918, -12.264287948608398, -10.840767860412598,
  -11.013248443603516, -12.07910442352295, -10.677984237670898,
  -10.580927848815918, -11.857215881347656, -
  10.670880317687988, -10.557984352111816, -11.725024223327637,
  -10.669343948364258, -10.531328201293945, -11.877632141113281,
  -10.67199993133545, -11.12342357635498, -12.025279998779297,
  -10.63584041595459, -10.772383689880371, -12.174528121948242,
  -10.288864135742188, -10.709312438964844, -11.656255722045898,
  -10.490240097045898, -10.413311958312988, -11.931679725646973,
  -10.630111694335938, -10.681183815002441, -11.72105598449707,
  -12.12656021118164, -10.345439910888672, -10.55782413482666,
  -10.49619197845459, -10.543135643005371, -10.385248184204102,
  -10.572064399719238, -10.489279747009277, -10.456000328063965,
  -10.422112464904785, -11.305055618286133, -10.928895950317383,
  -12.16761589050293, -11.416064262390137, -10.951264381408691,
  -11.365792274475098, -11.066240310668945, -10.718815803527832,
  -12.30835247039795, -10.656767845153809, -10.908479690551758,
  -11.050975799560547, -10.873279571533203, -10.92518424987793,
  -11.545215606689453, -10.567935943603516, -10.513824462890625,
  -11.226880073547363, -10.477184295654297],
 [-5.692448139190674, -5.382400035858154, -5.278079986572266,
  -5.2954559326171875, -5.2373762130737305, -5.638400077819824,
  -5.203743934631348, -5.1424641609191895, -5.394911766052246,
  -5.032192230224609, -5.182816028594971, -6.483839988708496,
  -5.317183971405029, -5.009056091308594, -5.118559837341309,
  -5.069568157196045, -5.366079807281494, -5.260064125061035,
  -5.807839870452881, -5.379104137420654, -5.292640209197998,
  -5.096704006195068, -5.138688087463379, -5.016736030578613,
  -5.581759929656982, -5.209407806396484, -5.24345588684082,
  -5.396671772003174, -5.23360013961792, -5.193727970123291,
  -5.348735809326172, -5.078144073486328, -5.3097920417785645,
  -5.264512062072754, -5.009696006774902, -5.206143856048584,
  -5.699007987976074, -5.088863849639893, -5.377664089202881,
  -5.280511856079102, -5.166399955749512, -5.460991859436035,
  -5.129759788513184, -5.250144004821777, -5.262080192565918,
  -5.132095813751221, -5.0905280113220215, -5.135839939117432,
  -5.253824234008789, -5.422783851623535, -
  5.136096000671387, -5.094111919403076, -5.246463775634766,
  -5.025184154510498, -5.057439804077148, -5.335231781005859,
  -5.253312110900879, -5.0899200439453125, -5.144608020782471,
  -5.142784118652344, -5.3921918869018555, -5.180511951446533,
  -5.841887950897217, -5.396639823913574, -5.285151958465576,
  -5.700607776641846, -5.20582389831543, -5.426176071166992,
  -5.605088233947754, -5.2123517990112305, -5.192416191101074,
  -5.098879814147949, -5.270751953125, -5.193312168121338,
  -5.695295810699463, -5.0733442306518555, -5.326848030090332,
  -5.066720008850098, -5.043935775756836, -5.272928237915039,
  -5.699584007263184, -5.455135822296143, -6.022560119628906,
  -5.479936122894287, -5.664576053619385, -5.225215911865234,
  -5.958816051483154, -5.514431953430176, -5.806591987609863,
  -5.456639766693115, -5.32374382019043, -5.386720180511475,
  -5.4661760330200195, -5.329472064971924, -5.676544189453125,
  -5.38259220123291, -5.326687812805176, -5.516928195953369,
  -5.459775924682617, -6.071392059326172],
 [-6.174015998840332, -6.0695037841796875, -6.34819221496582,
  -8.93939208984375, -6.825632095336914, -5.4488959312438965,
  -5.606815814971924, -5.535615921020508, -5.44268798828125,
  -5.380959987640381, -6.6260480880737305, -6.2296319007873535,
  -7.795807838439941, -8.699872016906738, -22.429920196533203,
  -20.033376693725586, -8.966239929199219, -8.969792366027832,
  -6.263584136962891, -7.326015949249268, -8.318079948425293,
  -9.347359657287598, -7.428895950317383, -6.90118408203125,
  -7.659200191497803, -7.770815849304199, -7.757023811340332,
  -6.855008125305176, -5.908448219299316, -5.829855918884277,
  -8.29849624633789, -7.986015796661377, -6.6743998527526855,
  -8.458815574645996, -9.449407577514648, -6.078464031219482,
  -6.128575801849365, -6.260287761688232, -8.834015846252441,
  -8.936415672302246, -6.035615921020508, -5.439519882202148,
  -5.608672142028809, -6.971456050872803, -6.002016067504883,
  -5.698944091796875, -5.757184028625488, -5.818943977355957,
  -7.658880233764648, -5.873280048370361, -
  5.627391815185547, -5.5015997886657715, -5.50432014465332,
  -7.291935920715332, -8.720447540283203, -8.371552467346191,
  -8.224191665649414, -7.842912197113037, -5.617152214050293,
  -5.466815948486328, -5.295904159545898, -5.503136157989502,
  -5.517856121063232, -6.253024101257324, -5.706975936889648,
  -5.578815937042236, -5.494783878326416, -6.08735990524292,
  -5.435359954833984, -5.561279773712158, -5.989439964294434,
  -6.127200126647949, -5.539616107940674, -5.641119956970215,
  -5.438943862915039, -5.474048137664795, -5.805759906768799,
  -5.72054386138916, -5.875936031341553, -5.56057596206665,
  -5.545599937438965, -5.523071765899658, -5.993951797485352,
  -5.590559959411621, -5.469727993011475, -5.481023788452148,
  -5.605760097503662, -5.924160003662109, -7.084799766540527,
  -5.588640213012695, -5.757887840270996, -5.7038397789001465,
  -5.346432209014893, -5.9456000328063965, -6.035808086395264,
  -5.672832012176514, -5.516992092132568, -5.5193281173706055,
  -5.807168006896973, -5.794112205505371]
]

if __name__ == '__main__':
    gpu_times = np.array(gpu_times)
    cpu_times = np.array(cpu_times)
    gpu_mean = np.mean(gpu_times, axis=1)
    cpu_mean = np.mean(cpu_times, axis=1)
    gpu_var = np.std(gpu_times, axis=1)
    cpu_var = np.std(cpu_times, axis=1)

    species = ["Input 1", "Input 2", "Input 3"]
    means = {
        'CPU Reward': cpu_mean,
        'GPU Reward': gpu_mean,
    }

    x = np.arange(len(gpu_mean))
    width = 0.33  # the width of the bars
    multiplier = 0

    fig, ax = plt.subplots(layout='constrained')

    for idx, (attribute, measurement) in enumerate(means.items()):
        offset = width * multiplier
        print(offset, measurement, width)
        if attribute == 'CPU Reward':
            errs = cpu_var[idx]
        elif attribute == 'GPU Reward':
            errs = gpu_var[idx]
        else:
            assert False

        rects = ax.bar(x + offset, measurement, width, yerr=errs,
                       label=attribute, ecolor='red', capsize=10, alpha=0.5)
        ax.bar_label(rects, padding=3)
        multiplier += 1

    # Add some text for labels, title and custom x-axis tick labels, etc.
    ax.set_ylabel('Reward and Standard Deviation over 100 Runs')
    ax.set_title('Reward for Homogeneous CPU/GPU '
                 'Allocation for Selected Inputs')
    ax.set_xticks(x + width, species)
    ax.legend(loc='upper left')  # , ncols=3)
    ax.set_ylim(-30, 0)

    plot_path = get_plot_path().joinpath(
        f"random_input_variance_cpu_and_gpu.png"
    )
    plt.savefig(plot_path)
    plt.show()
